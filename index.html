<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sunbeam Bakery</title>
  <meta name="description" content="A complex Cookie Clicker-style incremental game ready for GitHub Pages. Fully client-side, autosave, export/import." />
  <style>
    :root{--bg:#0b0e14;--card:#0f1724;--muted:#9aa3b2;--accent:#ffd893;--accent-2:#f5b2ff;--text:#eef3ff;--cookie-base:#c98b55;--cookie-dark:#8a4f2a;--cookie-shadow:#5a3216;--highlight:#fff8cc;--shine:#ffd154}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:var(--text);background:linear-gradient(180deg,#071021 0%, #081227 35%, #07121b 100%);}
    .wrap{max-width:1200px;margin:20px auto;padding:18px;display:grid;grid-template-columns:360px 1fr 360px;gap:18px}
    .panel{background:linear-gradient(180deg,var(--card),#0c1220);border-radius:14px;padding:14px;border:1px solid rgba(255,255,255,.03);box-shadow:0 10px 30px rgba(2,6,23,.6)}
    header.panel{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:radial-gradient(circle at 30% 25%, #fff6d0, #ffd08a 10%, #c5822b 55%, #6b3f18 100%);display:flex;align-items:center;justify-content:center;font-size:28px;box-shadow:inset 0 6px 10px rgba(255,255,255,.06),0 8px 30px rgba(0,0,0,.5)}
    h1{margin:0;font-size:20px}
    small{color:var(--muted)}

    /* left column */
    .left .stats{display:grid;gap:8px}
    .big-cookie-wrap{display:flex;align-items:center;justify-content:center;padding:18px}
    .big-cookie{width:280px;height:280px;border-radius:50%;position:relative;cursor:pointer;user-select:none;display:grid;place-items:center;transition:transform .08s ease}
    /* improved cookie look: more detailed gradients, more chips, subtle texture */
    .big-cookie .surface{position:absolute;inset:0;border-radius:50%;
      background:
        radial-gradient(60% 45% at 65% 35%, rgba(255,255,255,.12), transparent 15%),
        radial-gradient(30% 25% at 30% 70%, rgba(255,240,200,.06), transparent 10%),
        radial-gradient(20% 15% at 50% 50%, rgba(255,240,200,.08), transparent 20%),
        linear-gradient(180deg,var(--cookie-base),var(--cookie-dark) 60%,var(--cookie-shadow) 100%);
      box-shadow:0 20px 50px rgba(0,0,0,.55), inset 0 -14px 30px rgba(0,0,0,.3), inset 0 8px 24px rgba(255,255,255,.04);
      /* subtle texture */
      background-image: linear-gradient(180deg,var(--cookie-base),var(--cookie-dark) 60%,var(--cookie-shadow) 100%), url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAADBJREFUOE9jYOBa2cDAwMAABgABmQtOqwAAAABJRU5ErkJggg==');
      background-blend-mode: overlay;
    }
    .big-cookie .shine{position:absolute;left:18%;top:8%;width:60%;height:60%;border-radius:50%;background:radial-gradient(ellipse at 30% 20%, rgba(255,255,255,.25), rgba(255,255,255,.02) 30%, transparent 60%);filter:blur(6px);mix-blend-mode:screen}
    .chip{position:absolute;border-radius:50%;width:28px;height:28px;background:linear-gradient(180deg,#3b2314,#1e110a);box-shadow:inset 0 2px 4px rgba(255,255,255,.03),0 8px 18px rgba(0,0,0,.45)}
    .chip::after{content:'';position:absolute;inset:6px;border-radius:50%;background:rgba(0,0,0,.2)}
    .cookie-label{position:absolute;bottom:18px;font-weight:800;color:var(--accent);text-shadow:0 6px 18px rgba(0,0,0,.6)}
    .counters{padding:10px 6px}
    .counters .row{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,.02),transparent);border:1px solid rgba(255,255,255,.02)}
    .hint{font-size:13px;color:var(--muted);margin-top:6px}

    /* center */
    .tabs{display:flex;gap:8px;margin-bottom:10px}
    .tab{padding:8px 12px;border-radius:10px;background:transparent;border:1px solid transparent;color:var(--muted);cursor:pointer}
    .tab.active{background:linear-gradient(180deg,#0f1a2a,#0d1724);color:var(--text);border-color:rgba(255,255,255,.04)}
    .views{min-height:260px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px}
    .card-up{padding:10px;border-radius:12px;background:linear-gradient(180deg,#091225,#081220);border:1px solid rgba(255,255,255,.02);display:flex;gap:10px;align-items:center}
    .card-up .icon{width:46px;height:46px;border-radius:10px;display:grid;place-items:center;font-size:20px;background:linear-gradient(180deg,#13192a,#0d1120)}
    .card-up .meta{flex:1}
    .cost{font-weight:800;color:var(--accent)}

    /* right */
    .shop-list{display:grid;gap:8px}
    .shop-row{display:flex;gap:10px;align-items:center;padding:10px;border-radius:12px;background:linear-gradient(180deg,#081125,#07101a);border:1px solid rgba(255,255,255,.02)}
    .shop-row.locked{opacity:.5;filter:grayscale(.2)}
    .shop-row .btns{display:flex;gap:6px}
    .btn{background:#0b1220;padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.03);cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,#3a2d10,#2a210f);color:#fff}

    .footer{grid-column:1/-1;display:flex;justify-content:space-between;align-items:center;padding:10px 14px;margin-top:6px}

    /* toast */
    .toast{position:fixed;right:18px;bottom:18px;background:linear-gradient(180deg,#071225,#06101a);padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.02);opacity:0;transform:translateY(10px);transition:all .28s}
    .toast.show{opacity:1;transform:translateY(0)}

    @media(max-width:1100px){.wrap{grid-template-columns:1fr;}.footer{flex-direction:column;gap:8px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="panel">
      <div class="brand">
        <div class="logo">üç™</div>
        <div>
          <h1 id="bakeryName">Sunbeam Bakery</h1>
          <small id="bakeryTag">A cozy incremental bakery ‚Äî made for GitHub Pages</small>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn" id="exportBtn">Export</button>
        <button class="btn" id="importBtn">Import</button>
        <button class="btn primary" id="saveBtn">Save</button>
        <button class="btn" id="resetBtn">Reset</button>
      </div>
    </header>

    <section class="panel left">
      <div class="stats">
        <div class="big-cookie-wrap">
          <div id="bigCookie" class="big-cookie" title="Click to bake!" role="button" aria-label="Big cookie">
            <div class="surface"></div>
            <div class="shine"></div>
            <div id="chips" aria-hidden="true"></div>
            <div class="cookie-label">Bake!</div>
          </div>
        </div>
        <div class="counters">
          <div class="row"><div><strong id="cookies">0</strong> cookies</div><div id="cps">0 /s</div></div>
          <div class="row"><div><small>Per Click</small></div><div id="cpc">1</div></div>
          <div class="hint">Tip: Press Space or Enter to click. Hold Shift while purchasing for √ó10</div>
        </div>
      </div>
    </section>

    <section class="panel center">
      <div class="tabs">
        <div class="tab active" data-view="upgrades">Upgrades</div>
        <div class="tab" data-view="buildings">Buildings</div>
        <div class="tab" data-view="achievements">Achievements</div>
        <div class="tab" data-view="settings">Settings</div>
      </div>
      <div class="views">
        <div id="view-upgrades" class="view active">
          <div class="grid" id="upgradesGrid"></div>
        </div>
        <div id="view-buildings" class="view" style="display:none">
          <div class="grid" id="buildGrid"></div>
        </div>
        <div id="view-achievements" class="view" style="display:none">
          <div class="grid" id="achGrid"></div>
        </div>
        <div id="view-settings" class="view" style="display:none">
          <div style="display:grid;gap:8px">
            <div style="display:flex;gap:8px;align-items:center"><label style="flex:1">Bakery name</label><input id="nameInput" style="background:#081225;border:1px solid rgba(255,255,255,.02);padding:8px;border-radius:8px;color:var(--text)"/></div>
            <div style="display:flex;gap:8px;align-items:center"><label style="flex:1">Autosave (sec)</label><input id="autosaveInput" type="number" min="5" value="15" style="width:80px;background:#081225;border:1px solid rgba(255,255,255,.02);padding:8px;border-radius:8px;color:var(--text)"/></div>
            <div style="display:flex;gap:8px;align-items:center"><label style="flex:1">Show floats</label><input id="floatToggle" type="checkbox" checked/></div>
            <div><textarea id="exportBox" style="width:100%;min-height:120px;background:#06101a;border:1px solid rgba(255,255,255,.02);color:var(--text);padding:8px;border-radius:8px" placeholder="Exported save will appear here"></textarea></div>
          </div>
        </div>
      </div>
    </section>

    <aside class="panel right">
      <h3 style="margin-top:0">Shop</h3>
      <div class="shop-list" id="shopList"></div>
    </aside>

    <footer class="footer panel">
      <div>Client-only ‚Ä¢ Host on GitHub Pages ‚Ä¢ <span id="version">v1.3</span></div>
      <div id="saveInfo">Last save: ‚Äî</div>
    </footer>
  </div>

  <div id="toast" class="toast"></div>

  <script>
  // ---------- Utilities ----------
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const fmt = n => { if (!isFinite(n)) return '‚àû'; if (n>=1e12) return (n/1e12).toFixed(2)+'T'; if (n>=1e9) return (n/1e9).toFixed(2)+'B'; if (n>=1e6) return (n/1e6).toFixed(2)+'M'; if (n>=1e3) return (n/1e3).toFixed(2)+'K'; return Math.round(n).toLocaleString(); };
  const rand = (a,b)=> Math.random()*(b-a)+a;
  function toast(msg,ms=2000){const t=$('#toast');t.textContent=msg;t.classList.add('show');clearTimeout(t._t);t._t=setTimeout(()=>t.classList.remove('show'),ms);} 

  // ---------- Game Data ----------
  const BUILDINGS = [
    {id:'cursor',name:'Cursor',icon:'üñ±Ô∏è',base:15,mult:1.15,cps:0.1,desc:'Autoclicks occasionally.'},
    {id:'grandma',name:'Grandma',icon:'üëµ',base:100,mult:1.15,cps:1,desc:'Bakes with love.'},
    {id:'farm',name:'Farm',icon:'üåæ',base:1100,mult:1.15,cps:8,desc:'Grows cookie crops.'},
    {id:'mine',name:'Mine',icon:'‚õèÔ∏è',base:12000,mult:1.15,cps:47,desc:'Mines out chocolate chips.'},
    {id:'factory',name:'Factory',icon:'üè≠',base:130000,mult:1.15,cps:260,desc:'Industrial baking.'},
    {id:'bank',name:'Bank',icon:'üè¶',base:1400000,mult:1.15,cps:1400,desc:'Cookie interest.'},
    {id:'temple',name:'Temple',icon:'‚õ©Ô∏è',base:20000000,mult:1.15,cps:7800,desc:'Prayers for dough.'},
    {id:'wizard',name:'Wizard Tower',icon:'üßô',base:330000000,mult:1.15,cps:44000,desc:'Spells for sweets.'},
    {id:'shipment',name:'Shipment',icon:'üöÄ',base:5100000000,mult:1.15,cps:260000,desc:'Interplanetary cookies.'},
    {id:'alchemy',name:'Alchemy Lab',icon:'‚öóÔ∏è',base:75000000000,mult:1.15,cps:1600000,desc:'Transmutes gold into cookies.'},
  ];

  const UPGRADES = [
    {id:'reinforced',name:'Reinforced Index Finger',icon:'üëâ',desc:'Double your click power',cost:100,apply:s=>s.clickMult*=2,show: s=>s.totalClicks>=20},
    {id:'carpal',name:'Carpal Tunnel Cream',icon:'üß¥',desc:'+2 to base click',cost:800,apply:s=>s.baseClick+=2,show:s=>s.totalClicks>=200},
    {id:'ambidextrous',name:'Ambidextrous',icon:'üëê',desc:'+5 to base click',cost:5000,apply:s=>s.baseClick+=5,show:s=>s.totalClicks>=1000},
    {id:'grandmaRecr',name:'Grandma Recruitment',icon:'üßÅ',desc:'Grandmas produce +100%',cost:5000,apply:s=>s.buildings['grandma'].mult*=2,show:s=>s.buildings['grandma'].count>=5},
    {id:'grandmaLove',name:'Grandma Love',icon:'‚ù§Ô∏è',desc:'Grandmas +50% production',cost:15000,apply:s=>s.buildings['grandma'].mult*=1.5,show:s=>s.buildings['grandma'].count>=15},
    {id:'factoryBoost',name:'Factory Automation',icon:'üîß',desc:'Factories +150% production',cost:25000,apply:s=>s.buildings['factory'].mult*=2.5,show:s=>s.buildings['factory'].count>=3},
    {id:'factoryOverclock',name:'Factory Overclock',icon:'‚öôÔ∏è',desc:'Factories +100% production',cost:100000,apply:s=>s.buildings['factory'].mult*=2,show:s=>s.buildings['factory'].count>=10},
    {id:'farmFertilizer',name:'Farm Fertilizer',icon:'üå±',desc:'Farms +200% production',cost:20000,apply:s=>s.buildings['farm'].mult*=3,show:s=>s.buildings['farm'].count>=5},
    {id:'mineDrill',name:'Deep Drilling',icon:'üï≥Ô∏è',desc:'Mines +100% production',cost:50000,apply:s=>s.buildings['mine'].mult*=2,show:s=>s.buildings['mine'].count>=5},
    {id:'bankInterest',name:'Compound Interest',icon:'üí∞',desc:'Banks +50% production',cost:200000,apply:s=>s.buildings['bank'].mult*=1.5,show:s=>s.buildings['bank'].count>=5},
    {id:'templePrayer',name:'Divine Blessing',icon:'üôè',desc:'Temples +100% production',cost:1000000,apply:s=>s.buildings['temple'].mult*=2,show:s=>s.buildings['temple'].count>=3},
    {id:'wizardMana',name:'Mana Surge',icon:'‚ú®',desc:'Wizard Towers +150% production',cost:5000000,apply:s=>s.buildings['wizard'].mult*=2.5,show:s=>s.buildings['wizard'].count>=3},
    {id:'shipmentWarp',name:'Warp Drive',icon:'üåå',desc:'Shipments +100% production',cost:20000000,apply:s=>s.buildings['shipment'].mult*=2,show:s=>s.buildings['shipment'].count>=3},
    {id:'alchemyGold',name:'Philosopher\'s Stone',icon:'ü™Ñ',desc:'Alchemy Labs +200% production',cost:100000000,apply:s=>s.buildings['alchemy'].mult*=3,show:s=>s.buildings['alchemy'].count>=3},
    {id:'globalBoost1',name:'Cookie Amplifier',icon:'üîä',desc:'Global production +10%',cost:100000,apply:s=>s.globalMult*=1.1,show:s=>s.cookiesAllTime>=100000},
    {id:'globalBoost2',name:'Mega Amplifier',icon:'üì¢',desc:'Global production +20%',cost:1000000,apply:s=>s.globalMult*=1.2,show:s=>s.cookiesAllTime>=1000000},
  ];

  const ACHIEVEMENTS = [
    {id:'click100',name:'Finger Gym',desc:'Click 100 times',cond:s=>s.totalClicks>=100},
    {id:'click1000',name:'Click Master',desc:'Click 1,000 times',cond:s=>s.totalClicks>=1000},
    {id:'cookies1k',name:'Cookie Jar',desc:'Have 1,000 cookies banked',cond:s=>s.cookies>=1000},
    {id:'cookies1m',name:'Cookie Vault',desc:'Have 1,000,000 cookies banked',cond:s=>s.cookies>=1000000},
    {id:'own10',name:'Collector',desc:'Own 10 buildings total',cond:s=>totalBuildings(s)>=10},
    {id:'own50',name:'Hoarder',desc:'Own 50 buildings total',cond:s=>totalBuildings(s)>=50},
    {id:'grandma10',name:'Grandma Army',desc:'Own 10 grandmas',cond:s=>s.buildings['grandma'].count>=10},
    {id:'factory5',name:'Industrialist',desc:'Own 5 factories',cond:s=>s.buildings['factory'].count>=5},
    {id:'allUpgrades',name:'Upgrade Maniac',desc:'Buy all upgrades',cond:s=>Object.keys(s.upgrades).length >= UPGRADES.length},
    {id:'goldenClick',name:'Lucky Day',desc:'Click a golden cookie',cond:s=>s.goldenClicks>=1},
  ];

  // ---------- State ----------
  const SAVE_KEY='sunbeam-bakery-v1';
  let S = {
    bakeryName:'Sunbeam Bakery',
    cookies:0,
    cookiesAllTime:0,
    baseClick:1,
    clickMult:1,
    globalMult:1,
    totalClicks:0,
    goldenClicks:0,
    buildings:{},
    upgrades:{},
    achievements:{},
    lastSave:0,
    lastTick:Date.now(),
    timedMults:[],
    options:{autosave:15, floats:true}
  };
  BUILDINGS.forEach(b=>S.buildings[b.id]={count:0,mult:1});

  // ---------- Persistence ----------
  function save(){S.lastSave=Date.now();localStorage.setItem(SAVE_KEY,JSON.stringify(S));$('#saveInfo').textContent='Last save: '+new Date(S.lastSave).toLocaleString();toast('Saved ‚úì',900);} 
  function quickSaveIfDue(){const now=Date.now(); if(S.options.autosave && now-S._lastAutoSave > S.options.autosave*1000){save();S._lastAutoSave=now;}};
  window.addEventListener('beforeunload',save);

  function exportSave(){const txt=btoa(unescape(encodeURIComponent(JSON.stringify(S))));$('#exportBox').value=txt;toast('Exported save to textbox');}
  function importSave(){const raw=prompt('Paste save string here'); if(!raw) return; try{const obj=JSON.parse(decodeURIComponent(escape(atob(raw)))); S=Object.assign(S,obj); toast('Imported ‚úì'); applyAll(); save(); }catch(e){alert('Invalid save');}}
  function hardReset(){ if(!confirm('Reset bakery? This clears local save.')) return; localStorage.removeItem(SAVE_KEY); location.reload(); }

  function load(){const raw=localStorage.getItem(SAVE_KEY); if(raw){try{const obj=JSON.parse(raw); S=Object.assign(S,obj); // ensure buildings exist
      BUILDINGS.forEach(b=>{S.buildings[b.id]=S.buildings[b.id]||{count:0,mult:1}});
    }catch(e){console.warn(e);} }
    S._lastAutoSave=Date.now(); applyAll(); toast('Loaded save'); }

  // ---------- Mechanics ----------
  function totalBuildings(state){return BUILDINGS.reduce((t,b)=>t+ (state.buildings[b.id]?.count||0),0)}
  function cookiesPerClick(){return S.baseClick * S.clickMult * S.globalMult}
  function calcCPS(){let cps=0; for(const b of BUILDINGS){const st=S.buildings[b.id]; cps += st.count * b.cps * st.mult;} return cps * S.globalMult}

  function addCookies(n){S.cookies+=n; S.cookiesAllTime+=n;}

  function clickCookie(x,y){const add=cookiesPerClick(); // crits
    if(Math.random()<0.03){ const mult=10; addCookies(add*mult); spawnFloat('CRIT! x'+mult,x,y); } else { addCookies(add); if(S.options.floats) spawnFloat('+'+fmt(add),x,y); }
    S.totalClicks++; updateAll(); }

  function buyBuilding(id,qty=1){const b=BUILDINGS.find(x=>x.id===id);const st=S.buildings[id]; let cost=0; for(let i=0;i<qty;i++){ cost += Math.floor(b.base * Math.pow(b.mult, st.count + i)); } if(S.cookies < cost){toast('Not enough cookies'); return false;} S.cookies -= cost; st.count += qty; updateAll(); return true; }

  // timed multipliers
  function addTimedMult(mult,ms){S.timedMults.push({mult,until:Date.now()+ms});}
  function currentTimedMult(){S.timedMults = S.timedMults.filter(m=>m.until>Date.now()); return S.timedMults.reduce((t,m)=>t*m.mult,1)}

  // ---------- Golden cookie ----------
  let goldenTimer = rand(40,120);
  function maybeSpawnGolden(dt){goldenTimer -= dt; if(goldenTimer<=0){spawnGolden(); goldenTimer = rand(45,120);} }
  function spawnGolden(){ const g = document.createElement('div'); g.className='golden'; g.style.position='fixed'; g.style.width='64px'; g.style.height='64px'; g.style.borderRadius='50%'; g.style.display='grid'; g.style.placeItems='center'; g.style.left=rand(80,innerWidth-160)+'px'; g.style.top=rand(120,innerHeight-220)+'px'; g.style.zIndex=9999; g.style.background='radial-gradient(circle at 30% 30%, var(--highlight), var(--shine) 40%, #d09b2a 70%, #8a5a1f 100%)'; g.textContent='üçØ'; document.body.appendChild(g); const t=setTimeout(()=>g.remove(),12000); g.onclick=()=>{clearTimeout(t); g.remove(); S.goldenClicks++; if(Math.random()<0.5){ addTimedMult(7,30000); toast('Frenzy! x7 for 30s'); } else { const gain = Math.max(100, calcCPS()*10 + cookiesPerClick()*50); addCookies(gain); toast('Cookie shower! +'+fmt(gain)); } updateAll(); } }

  // ---------- UI Rendering ----------
  function seedChips(){const wrap=$('#chips');wrap.innerHTML=''; const r=110,cx=140,cy=140; for(let i=0;i<40;i++){const t=Math.random()*Math.PI*2;const rr=r*rand(.25,.9);const x=cx+Math.cos(t)*rr;const y=cy+Math.sin(t)*rr;const el=document.createElement('div');el.className='chip';el.style.left=(x-14)+'px';el.style.top=(y-14)+'px';el.style.width=rand(20,32)+'px';el.style.height=el.style.width;wrap.appendChild(el);} }

  function renderBuildings(){const g=$('#shopList'); g.innerHTML=''; for(const b of BUILDINGS){ const st=S.buildings[b.id]; const nextCost=Math.floor(b.base * Math.pow(b.mult, st.count)); const el=document.createElement('div'); el.className='shop-row'+(S.cookies<nextCost?' locked':''); el.innerHTML=`<div style="font-size:22px">${b.icon}</div><div style="flex:1"><div style="font-weight:800">${b.name} <small style="color:var(--muted);font-weight:600">x${st.count}</small></div><div style="color:var(--muted);font-size:13px">${b.desc}</div></div><div style="text-align:right"><div style="font-weight:900;color:var(--accent)">${fmt(nextCost)}</div><div class="btns"><button class="btn" data-buy="1">+1</button><button class="btn" data-buy="10">+10</button></div></div>`; el.querySelector('[data-buy="1"]').onclick=()=>buyBuilding(b.id,1); el.querySelector('[data-buy="10"]').onclick=()=>buyBuilding(b.id,10); g.appendChild(el);} }

  function renderUpgrades(){const g=$('#upgradesGrid'); g.innerHTML=''; for(const u of UPGRADES){ const owned=!!S.upgrades[u.id]; const visible = u.show ? u.show(S) : true; if(!visible && !owned) continue; const el=document.createElement('div'); el.className='card-up'+(owned?' owned':''); el.innerHTML=`<div class="icon">${u.icon}</div><div class="meta"><div style="font-weight:800">${u.name} ${owned?'<small style="color:var(--muted)">[owned]</small>':''}</div><div style="color:var(--muted);font-size:13px">${u.desc}</div></div><div style="text-align:right"><div class="cost">${owned?'-':fmt(u.cost)}</div><div style="margin-top:6px"><button class="btn">Buy</button></div></div>`; el.querySelector('.btn').onclick=()=>{ if(owned){toast('Already owned'); return;} if(S.cookies < u.cost){toast('Not enough cookies');return;} S.cookies -= u.cost; S.upgrades[u.id]=true; if(u.apply) u.apply(S); toast('Upgrade bought: '+u.name); updateAll(); }; g.appendChild(el);} }

  function renderAchievements(){const g=$('#achGrid'); g.innerHTML=''; for(const a of ACHIEVEMENTS){ const got=!!S.achievements[a.id]; const el=document.createElement('div'); el.className='card-up'+(got?'':' locked'); el.innerHTML=`<div class="icon">üèÖ</div><div class="meta"><div style="font-weight:800">${a.name} ${got?'<small style="color:var(--muted)">[unlocked]</small>':''}</div><div style="color:var(--muted);font-size:13px">${a.desc}</div></div>`; g.appendChild(el);} }

  function updateCounters(){ $('#cookies').textContent = fmt(Math.floor(S.cookies)); $('#cps').textContent = fmt((calcCPS()*currentTimedMult()).toFixed(2)) + ' /s'; $('#cpc').textContent = fmt(Math.round(cookiesPerClick())); }

  function applyAll(){ $('#bakeryName').textContent = S.bakeryName||'Sunbeam Bakery'; $('#nameInput').value = S.bakeryName||'Sunbeam Bakery'; seedChips(); renderBuildings(); renderUpgrades(); renderAchievements(); updateCounters(); $('#saveInfo').textContent = S.lastSave ? 'Last save: '+new Date(S.lastSave).toLocaleString() : 'Last save: ‚Äî'; }

  function checkAchievements(){ for(const a of ACHIEVEMENTS){ if(!S.achievements[a.id] && a.cond(S)){ S.achievements[a.id]=true; toast('Achievement: '+a.name); } } }

  function updateAll(){ renderBuildings(); renderUpgrades(); renderAchievements(); updateCounters(); checkAchievements(); $('#exportBox').value = btoa(unescape(encodeURIComponent(JSON.stringify(S)))); }

  // ----------- Floating numbers ----------
  function spawnFloat(txt,x=rand(innerWidth/2-80,innerWidth/2+80),y=rand(innerHeight/2-80,innerHeight/2+80)){ if(!S.options.floats) return; const el=document.createElement('div'); el.textContent=txt; el.style.position='fixed'; el.style.left=(x)+'px'; el.style.top=(y)+'px'; el.style.fontWeight='800'; el.style.color='#fff'; el.style.zIndex=9999; el.style.pointerEvents='none'; el.style.textShadow='0 6px 18px rgba(0,0,0,.6)'; document.body.appendChild(el); const v=rand(-40,-80); el.animate([{transform:'translateY(0)',opacity:1},{transform:`translateY(${v}px)`,opacity:0}],{duration:900,easing:'cubic-bezier(.2,.8,.2,1)'}); setTimeout(()=>el.remove(),900); }

  // ---------- Main loop ----------
  let last = Date.now(); function tick(){ const now=Date.now(); const dt=(now-last)/1000; last=now; const mult=currentTimedMult(); const gain = calcCPS()*mult*dt; if(gain>0){ S.cookies += gain; S.cookiesAllTime += gain; } maybeSpawnGolden(dt); updateCounters(); quickSaveIfDue(); requestAnimationFrame(tick); }

  // ---------- DOM Events ----------
  function bind(){ // cookie click
    $('#bigCookie').addEventListener('click',e=>{ const rect=e.currentTarget.getBoundingClientRect(); clickCookie(e.clientX,e.clientY); $('#bigCookie').animate([{transform:'scale(1)'},{transform:'scale(.97)'},{transform:'scale(1)'}],{duration:120}); });
    document.addEventListener('keydown',e=>{ if(e.code==='Space' || e.code==='Enter'){ e.preventDefault(); clickCookie(rand(innerWidth/2-80,innerWidth/2+80),rand(innerHeight/2-80,innerHeight/2+80)); } });

    // tabs
    $$('.tab').forEach(t=>t.addEventListener('click',()=>{ $$('.tab').forEach(x=>x.classList.remove('active')); t.classList.add('active'); $$('.view').forEach(v=>v.style.display='none'); const id='view-'+t.dataset.view; const el=document.getElementById(id); if(el) el.style.display='block'; }));

    // save controls
    $('#saveBtn').onclick = ()=>save(); $('#exportBtn').onclick = ()=>exportSave(); $('#importBtn').onclick = ()=>importSave(); $('#resetBtn').onclick = ()=>hardReset();

    $('#autosaveInput').onchange = e=>{ const v=parseInt(e.target.value)||15; S.options.autosave=v; };
    $('#nameInput').onchange = e=>{ S.bakeryName = e.target.value || 'Sunbeam Bakery'; $('#bakeryName').textContent = S.bakeryName; };

    // building buy hotkeys in shop will attach on render
  }

  // ---------- Init ----------
  seedChips(); bind(); load(); last=Date.now(); tick(); setInterval(()=>{ save(); }, 1000*30);

  // expose for debugging
  window.S = S; window.saveGame = save; window.loadGame = load;
  </script>
</body>
</html>
